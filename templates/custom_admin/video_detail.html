{% extends 'custom_admin/admin_base.html' %}

{% block page_title %}Video Details{% endblock %}
{% block page_subtitle %}{{ video.title|truncatechars:50 }}{% endblock %}

{% block content %}
<div class="row">
    <!-- Video Preview -->
    <div class="col-lg-8">
        <div class="card stats-card mb-4">
            <div class="card-body">
                {% if video.thumbnail %}
                    <img src="{{ video.thumbnail.url }}" class="img-fluid rounded mb-3" style="max-height: 400px; width: 100%; object-fit: cover;">
                {% else %}
                    <div class="bg-secondary rounded d-flex align-items-center justify-content-center mb-3" style="height: 300px;">
                        <i class="bi bi-play-circle fs-1 text-white"></i>
                    </div>
                {% endif %}
                
                <h4>{{ video.title }}</h4>
                {% if video.description %}
                    <p class="text-muted">{{ video.description|truncatewords:50 }}</p>
                {% endif %}
                
                <div class="d-flex gap-2 mb-3">
                    <span class="badge bg-secondary">{{ video.get_category_display }}</span>
                    {% if video.visibility == 'public' %}
                        <span class="badge bg-success">Public</span>
                    {% elif video.visibility == 'private' %}
                        <span class="badge bg-danger">Private</span>
                    {% else %}
                        <span class="badge bg-warning">{{ video.get_visibility_display }}</span>
                    {% endif %}
                    <span class="badge bg-info">{{ video.get_processing_status_display }}</span>
                </div>
                
                <div class="row text-center">
                    <div class="col-3">
                        <h5 class="text-primary">{{ video.view_count|floatformat:0 }}</h5>
                        <small class="text-muted">Views</small>
                    </div>
                    <div class="col-3">
                        <h5 class="text-success">{{ video.like_count|floatformat:0 }}</h5>
                        <small class="text-muted">Likes</small>
                    </div>
                    <div class="col-3">
                        <h5 class="text-danger">{{ video.dislike_count|floatformat:0 }}</h5>
                        <small class="text-muted">Dislikes</small>
                    </div>
                    <div class="col-3">
                        <h5 class="text-info">{{ video.comment_count|floatformat:0 }}</h5>
                        <small class="text-muted">Comments</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Full Description -->
        {% if video.description %}
        <div class="card stats-card">
            <div class="card-header">
                <h6 class="mb-0">Description</h6>
            </div>
            <div class="card-body">
                <p style="white-space: pre-line;">{{ video.description }}</p>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Video Info and Actions -->
    <div class="col-lg-4">
        <!-- Basic Info -->
        <div class="card stats-card mb-4">
            <div class="card-header">
                <h6 class="mb-0">Video Information</h6>
            </div>
            <div class="card-body">
                <table class="table table-borderless table-sm">
                    <tr>
                        <th width="40%">Duration:</th>
                        <td>{{ video.duration_formatted|default:"Unknown" }}</td>
                    </tr>
                    <tr>
                        <th>Resolution:</th>
                        <td>
                            {% if video.resolution_width and video.resolution_height %}
                                {{ video.resolution_width }}x{{ video.resolution_height }}
                            {% else %}
                                Unknown
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>File Size:</th>
                        <td>
                            {% if video.file_size %}
                                {{ video.file_size|filesizeformat }}
                            {% else %}
                                Unknown
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Language:</th>
                        <td>{{ video.language|upper }}</td>
                    </tr>
                    <tr>
                        <th>Age Restriction:</th>
                        <td>{{ video.get_age_restriction_display }}</td>
                    </tr>
                    <tr>
                        <th>Uploaded:</th>
                        <td>{{ video.uploaded_at|date:"M d, Y H:i" }}</td>
                    </tr>
                    {% if video.published_at %}
                    <tr>
                        <th>Published:</th>
                        <td>{{ video.published_at|date:"M d, Y H:i" }}</td>
                    </tr>
                    {% endif %}
                </table>
                
                {% if video.tags %}
                <div class="mt-3">
                    <h6>Tags</h6>
                    {% for tag in video.get_tags_list %}
                        <span class="badge bg-light text-dark me-1 mb-1">#{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Channel Info -->
        <div class="card stats-card mb-4">
            <div class="card-header">
                <h6 class="mb-0">Channel Information</h6>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center mb-2">
                    {% if video.channel.avatar %}
                        <img src="{{ video.channel.avatar.url }}" class="rounded-circle me-2" width="40" height="40">
                    {% else %}
                        <div class="bg-info rounded-circle me-2 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                            <i class="bi bi-tv text-white"></i>
                        </div>
                    {% endif %}
                    <div>
                        <div class="fw-semibold">{{ video.channel.name }}</div>
                        <small class="text-muted">{{ video.channel.handle }}</small>
                    </div>
                </div>
                <small class="text-muted">{{ video.channel.subscriber_count|floatformat:0 }} subscribers</small>
                
                <div class="mt-3">
                    <a href="{% url 'custom_admin:channel_detail' video.channel.id %}" class="btn btn-sm btn-outline-primary w-100">
                        View Channel Details
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Admin Actions -->
        <div class="card stats-card">
            <div class="card-header">
                <h6 class="mb-0">Admin Actions</h6>
            </div>
            <div class="card-body">
                <form method="POST">
                    {% csrf_token %}
                    
                    <!-- Visibility Change -->
                    <div class="mb-3">
                        <label class="form-label">Change Visibility</label>
                        <div class="d-flex gap-2">
                            <select name="visibility" class="form-select">
                                <option value="public" {% if video.visibility == 'public' %}selected{% endif %}>Public</option>
                                <option value="private" {% if video.visibility == 'private' %}selected{% endif %}>Private</option>
                                <option value="unlisted" {% if video.visibility == 'unlisted' %}selected{% endif %}>Unlisted</option>
                            </select>
                            <button type="submit" name="action" value="toggle_visibility" class="btn btn-sm btn-outline-primary">
                                Update
                            </button>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <!-- Danger Zone -->
                    <div class="d-grid gap-2">
                        <a href="{% url 'videos:watch' video.slug %}" target="_blank" class="btn btn-outline-primary">
                            <i class="bi bi-play me-2"></i>Watch Video
                        </a>
                        <a href="{% url 'custom_admin:video_management' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-2"></i>Back to Videos
                        </a>
                        
                        <hr>
                        
                        <button type="submit" name="action" value="delete_video" 
                                class="btn btn-outline-danger"
                                onclick="return confirmDelete('{{ video.title }}')">
                            <i class="bi bi-trash me-2"></i>Delete Video
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}